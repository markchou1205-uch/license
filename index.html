<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å•Ÿè‹±é«˜ä¸­å­¸ç”Ÿè·æ¥­è­‰ç…§ç®¡ç†ç³»çµ±</title>
  <style>
    :root {
      --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#22d3ee; --danger:#ef4444;
      --btn:#1f2937; --btn2:#0ea5e9;
    }
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(120deg,#0b1020,#0e1428 60%,#0b1020)}
    .wrap{max-width:980px;margin:40px auto;padding:24px}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:24px 28px;color:var(--text)}
    h1{margin:0 0 6px;font-size:28px;letter-spacing:.5px}
    p.sub{margin:0 0 18px;color:var(--muted)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:860px){.row{grid-template-columns:1fr}}
    label{display:block;font-size:13px;color:#cbd5e1;margin:14px 0 8px}
    input,select{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #334155;background:#0b1220;color:#e5e7eb;outline:none}
    input:focus,select:focus{border-color:var(--accent)}
    .radio-group{display:flex;gap:12px;margin:8px 0 4px}
    .radio{display:flex;gap:8px;align-items:center;background:#0b1220;border:1px solid #334155;border-radius:999px;padding:8px 12px;cursor:pointer}
    .btn{display:inline-block;padding:12px 18px;border-radius:12px;border:1px solid #334155;background:var(--btn);color:#e5e7eb;text-decoration:none;cursor:pointer}
    .btn.primary{background:var(--btn2);border-color:#0284c7}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .actions{display:flex;gap:10px;margin-top:18px}
    .hint{color:var(--muted);font-size:12px;margin-top:6px}
    .error{color:var(--danger);font-size:13px;margin-top:8px}
    .divider{height:1px;background:#1f2937;margin:18px 0}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .badge{display:inline-block;background:#0b1220;border:1px solid #334155;color:#a5b4fc;padding:6px 10px;border-radius:999px;font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>åå†Šï¼‹è­‰ç…§ç³»çµ±</h1>
      <p class="sub">Google Apps Script å¾Œç«¯ / Spreadsheet è³‡æ–™åº«</p>

      <label>é¸æ“‡èº«åˆ†</label>
      <div class="radio-group" id="roleGroup">
        <div class="radio"><input type="radio" name="role" id="roleStudent" value="student" checked><span>å­¸ç”Ÿ</span></div>
        <div class="radio"><input type="radio" name="role" id="roleTeacher" value="teacher"><span>æ•™å¸«</span></div>
      </div>

      <div id="studentPanel">
        <span class="badge">å­¸ç”Ÿç™»å…¥</span>
        <div class="row">
          <div>
            <label>å­¸è™Ÿï¼ˆ6ç¢¼æ•¸å­—ï¼‰</label>
            <input id="stuSid" inputmode="numeric" placeholder="ä¾‹å¦‚ï¼š215106" maxlength="6">
          </div>
          <div>
            <label>èº«åˆ†è­‰å­—è™Ÿï¼ˆ1è‹±æ–‡å­—æ¯ + 9æ•¸å­—ï¼‰</label>
            <input id="stuNid" placeholder="ä¾‹å¦‚ï¼šA123456789" maxlength="10">
          </div>
        </div>
        <div class="actions">
          <button class="btn primary" id="btnStuLogin">å­¸ç”Ÿç™»å…¥</button>
        </div>
        <div class="hint">èªªæ˜ï¼šæœƒåˆ° Google è©¦ç®—è¡¨ã€Œåå†Š+è­‰ç…§ã€ç¬¬ 3 æ¬„ä»¥å­¸è™Ÿæœå°‹ï¼Œä¸¦æ¯”å°ç¬¬ 6 æ¬„èº«åˆ†è­‰å­—è™Ÿã€‚</div>
        <div class="error" id="stuErr"></div>
        <div class="divider"></div>
      </div>

      <div id="teacherPanel" style="display:none">
        <span class="badge">æ•™å¸«ç™»å…¥</span>
        <div class="grid2">
          <div>
            <label>æ•™å¸«å¸³è™Ÿï¼ˆ5ç¢¼ï¼‰</label>
            <input id="tAcc" placeholder="ä¾‹å¦‚ï¼š12345" maxlength="5">
          </div>
          <div>
            <label>å¯†ç¢¼ï¼ˆå›ºå®šï¼š123456ï¼‰</label>
            <input id="tPwd" type="password" placeholder="123456" value="">
          </div>
        </div>

        <div class="grid2">
          <div>
            <label>ç¾¤ç§‘</label>
            <select id="tDept"></select>
          </div>
          <div>
            <label>ç­ç´š</label>
            <select id="tClass"></select>
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="btnTeaLogin">æ•™å¸«ç™»å…¥</button>
        </div>
        <div class="hint">èªªæ˜ï¼šå¯†ç¢¼å›ºå®šç‚º 123456ã€‚æœƒåˆ° Google è©¦ç®—è¡¨ç¬¬ 2 æ¬„ä»¥ã€Œç­ç´šåç¨±ã€æœå°‹ä¸¦å›å‚³å°æ‡‰è³‡æ–™åˆ—ã€‚</div>
        <div class="error" id="teaErr"></div>
      </div>
    </div>
  </div>

  <script>
    // ğŸ‘‰ æ›æˆä½ éƒ¨ç½²çš„ Apps Script Web App URL
    const GAS_BASE = 'https://script.google.com/macros/s/XXXXXXXXXXXXXXXXXXXXXXXXXXXX/exec';

    // ç¾¤ç§‘ â†’ ç­ç´šå°æ‡‰ï¼ˆé¡Œç›®æä¾›ï¼‰
    const DEPT_CLASS_MAP = {
      "æ™®é€šç§‘": ["æ™®é€šäºŒç”²","æ™®é€šä¸‰ç”²","æ™®é€šä¸‰ä¹™","æ™®é€šä¸€æˆŠ","æ™®é€šäºŒæˆŠ","æ™®é€šä¸‰æˆŠ","æ™®é€šä¸€å·±","æ™®é€šäºŒå·±","æ™®é€šä¸‰å·±"],
      "æ±½è»Šç§‘": ["æ±½è»Šä¸€ç”²","æ±½è»ŠäºŒç”²","æ±½è»Šä¸‰ç”²","æ±½è»Šä¸€æˆŠ","æ±½è»ŠäºŒæˆŠ","æ±½è»Šä¸‰æˆŠ"],
      "è³‡è¨Šç§‘": ["è³‡è¨ŠäºŒç”²","è³‡è¨Šä¸‰ç”²","è³‡è¨Šä¸€æˆŠ","è³‡è¨ŠäºŒæˆŠ","è³‡è¨Šä¸‰æˆŠ"],
      "åƒ‘ç”Ÿå»ºæ•™è³‡è¨Š": ["åƒ‘è³‡ä¸€ç”²A","åƒ‘è³‡ä¸€ç”²B","åƒ‘è³‡äºŒç”²A","åƒ‘è³‡äºŒç”²B","åƒ‘è³‡ä¸‰ç”²A","åƒ‘è³‡ä¸‰ç”²B"],
      "è³‡æ–™è™•ç†ç§‘": ["è³‡è™•äºŒæˆŠ","è³‡è™•ä¸‰æˆŠ"],
      "å»£å‘Šè¨­è¨ˆç§‘": ["å»£è¨­ä¸€ç”²","å»£è¨­äºŒç”²","å»£è¨­ä¸‰ç”²","å»£è¨­äºŒæˆŠ","å»£è¨­ä¸‰æˆŠ"],
      "é¤é£²ç®¡ç†ç§‘": ["é¤ç®¡ä¸€ç”²","é¤ç®¡äºŒç”²","é¤ç®¡ä¸‰ç”²","é¤ç®¡ä¸€ä¹™","é¤ç®¡äºŒä¹™","é¤ç®¡ä¸‰ä¹™","é¤ç®¡ä¸€ä¸™","é¤ç®¡äºŒä¸™","é¤ç®¡ä¸‰ä¸™","é¤ç®¡ä¸€ä¸","é¤ç®¡äºŒä¸","é¤ç®¡ä¸€æˆŠ","é¤ç®¡äºŒæˆŠ","é¤ç®¡ä¸‰æˆŠ"],
      "é›»å­å•†å‹™ç§‘": ["é›»å•†ä¸€ç”²","é›»å•†äºŒç”²","é›»å•†ä¸‰ç”²"],
      "æ‡‰ç”¨è‹±èªç§‘": ["æ‡‰è‹±ä¸‰æˆŠ","æ‡‰è‹±äºŒæˆŠ"],
      "æ‡‰ç”¨æ—¥èªç§‘": ["æ‡‰æ—¥ä¸‰æˆŠ","æ‡‰æ—¥ä¸€æˆŠ","æ‡‰æ—¥äºŒæˆŠ"],
      "åƒ‘ç”Ÿå»ºæ•™é¤ç®¡": ["åƒ‘é¤ä¸€ç”²A","åƒ‘é¤ä¸€ç”²B"],
      "å®¤å…§è¨­è¨ˆç§‘": ["å®¤è¨­äºŒç”²","å®¤è¨­ä¸‰ç”²","å®¤è¨­ä¸€æˆŠ","å®¤è¨­äºŒæˆŠ","å®¤è¨­ä¸‰æˆŠ"],
      "æ™‚å°šé€ å‹ç§‘": ["æ™‚å°šä¸€ç”²","æ™‚å°šäºŒç”²","æ™‚å°šä¸‰ç”²","æ™‚å°šäºŒä¹™","æ™‚å°šä¸€æˆŠ","æ™‚å°šäºŒæˆŠ","æ™‚å°šä¸‰æˆŠ"],
      "åƒ‘ç”Ÿå»ºæ•™æ™‚å°š": ["åƒ‘æ™‚ä¸€ç”²A","åƒ‘æ™‚ä¸€ç”²B","åƒ‘æ™‚äºŒç”²A","åƒ‘æ™‚äºŒç”²B"],
      "éŸ³æ¨‚ç§‘": ["éŸ³æ¨‚ä¸€ç”²","éŸ³æ¨‚äºŒç”²","éŸ³æ¨‚ä¸‰ç”²"],
      "é›»å½±é›»è¦–ç§‘": ["å½±è¦–äºŒç”²","å½±è¦–ä¸‰ç”²"],
      "è¡¨æ¼”è—è¡“ç§‘": ["è¡¨è—ä¸€ç”²","è¡¨è—äºŒç”²","è¡¨è—ä¸‰ç”²","è¡¨è—ä¸€ä¹™","è¡¨è—äºŒä¹™","è¡¨è—ä¸‰ä¹™"],
      "ç¶œåˆè·èƒ½ç§‘": ["ç¶œè·ä¸€ç”²","ç¶œè·äºŒç”²","ç¶œè·ä¸‰ç”²"],
      "å¯µç‰©ç¶“ç‡Ÿç§‘": ["å¯¦å¯µä¸€ç”²"],
      "æ±½è»Šä¿®è­·ç§‘": ["å¯¦æ±½ä¸€ç”²","å¯¦æ±½äºŒç”²","å¯¦æ±½ä¸‰ç”²","å¯¦æ±½äºŒä¹™","å¯¦æ±½ä¸‰ä¹™"],
      "å¾®é›»è…¦ä¿®è­·ç§‘": ["å¯¦å¾®ä¸‰ç”²"],
      "é¤é£²æŠ€è¡“ç§‘": ["å¯¦é¤ä¸€ç”²","å¯¦é¤äºŒç”²","å¯¦é¤ä¸‰ç”²"],
      "ç¾é«®æŠ€è¡“ç§‘": ["å¯¦é«®ä¸€ç”²","å¯¦é«®äºŒç”²","å¯¦é«®ä¸‰ç”²"],
      "ç¾å®¹é€ å‹ç§‘": ["å¯¦å®¹ä¸€ç”²","å¯¦å®¹äºŒç”²","å¯¦å®¹ä¸‰ç”²"]
    };

    // UI å…ƒä»¶
    const roleStudent = document.querySelector('#roleStudent');
    const roleTeacher = document.querySelector('#roleTeacher');
    const studentPanel = document.querySelector('#studentPanel');
    const teacherPanel = document.querySelector('#teacherPanel');
    const tDept = document.querySelector('#tDept');
    const tClass = document.querySelector('#tClass');

    // åˆ‡æ›é¢æ¿
    document.getElementById('roleGroup').addEventListener('change', () => {
      const isStu = roleStudent.checked;
      studentPanel.style.display = isStu ? '' : 'none';
      teacherPanel.style.display = isStu ? 'none' : '';
    });

    // å¡«å…¥ç¾¤ç§‘ã€é€£å‹•ç­ç´š
    function renderDepts(){
      tDept.innerHTML = '';
      for(const dept of Object.keys(DEPT_CLASS_MAP)){
        const opt = document.createElement('option');
        opt.value = opt.textContent = dept;
        tDept.appendChild(opt);
      }
      renderClasses();
    }
    function renderClasses(){
      tClass.innerHTML = '';
      const list = DEPT_CLASS_MAP[tDept.value] || [];
      for(const c of list){
        const opt = document.createElement('option');
        opt.value = opt.textContent = c;
        tClass.appendChild(opt);
      }
    }
    tDept.addEventListener('change', renderClasses);
    renderDepts();

    // æª¢æ ¸
    const isValidSid = v => /^\d{6}$/.test(v);
    const isValidTeacherAcc = v => /^\d{5}$/.test(v);
    const isValidNID = v => /^[A-Za-z][12]\d{8}$/.test(v);

    // å­¸ç”Ÿç™»å…¥
    document.getElementById('btnStuLogin').addEventListener('click', async ()=>{
      const sid = (document.getElementById('stuSid').value||'').trim();
      const nid = (document.getElementById('stuNid').value||'').trim().toUpperCase();
      const err = document.getElementById('stuErr'); err.textContent = '';

      if(!isValidSid(sid)){ err.textContent='å­¸è™Ÿéœ€ç‚º 6 ç¢¼æ•¸å­—ã€‚'; return; }
      if(!isValidNID(nid)){ err.textContent='èº«åˆ†è­‰å­—è™Ÿæ ¼å¼éŒ¯èª¤ï¼ˆ1 å­—æ¯ + æ€§åˆ¥ç¢¼ 1/2 + 8 ç¢¼ï¼‰ã€‚'; return; }

      try{
        const body = new URLSearchParams({ path:'login_student', sid, nid }).toString();
        const r = await fetch(GAS_BASE, { method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'}, body });
        const data = await r.json();
        if(!data.ok){ err.textContent = data.error || 'ç™»å…¥å¤±æ•—'; return; }
        // å­˜åˆ° sessionStorageï¼Œè·³é 
        sessionStorage.setItem('studentRow', JSON.stringify(data.row));
        location.href = 'student.html';
      }catch(e){
        err.textContent = 'é€£ç·šç•°å¸¸ï¼š' + e.message;
      }
    });

    // æ•™å¸«ç™»å…¥
    document.getElementById('btnTeaLogin').addEventListener('click', async ()=>{
      const account = (document.getElementById('tAcc').value||'').trim();
      const password = (document.getElementById('tPwd').value||'').trim();
      const dept = tDept.value;
      const clazz = tClass.value;
      const err = document.getElementById('teaErr'); err.textContent='';

      if(!isValidTeacherAcc(account)){ err.textContent='æ•™å¸«å¸³è™Ÿéœ€ç‚º 5 ç¢¼ã€‚'; return; }
      if(password !== '123456'){ err.textContent='å¯†ç¢¼éŒ¯èª¤ï¼ˆå›ºå®šç‚º 123456ï¼‰ã€‚'; return; }
      if(!dept || !clazz){ err.textContent='è«‹é¸æ“‡ç¾¤ç§‘èˆ‡ç­ç´šã€‚'; return; }

      try{
        const body = new URLSearchParams({ path:'login_teacher', account, password, dept, clazz }).toString();
        const r = await fetch(GAS_BASE, { method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'}, body });
        const data = await r.json();
        if(!data.ok){ err.textContent = data.error || 'ç™»å…¥å¤±æ•—'; return; }
        sessionStorage.setItem('teacherList', JSON.stringify({ dept, clazz, rows: data.rows }));
        location.href = 'teacher.html';
      }catch(e){
        err.textContent = 'é€£ç·šç•°å¸¸ï¼š' + e.message;
      }
    });
  </script>
</body>
</html>
